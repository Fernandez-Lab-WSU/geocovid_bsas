{"title":"Creación Mapas Buenos Aires","markdown":{"yaml":{"title":"Creación Mapas Buenos Aires","lang":"es"},"headingText":"Area Metropolitana de Buenos Aires (AMBA) y Ciudad Autonoma de Buenos Aires (CABA)","containsRefs":false,"markdown":"\n\n---\n\n**Datos iniciales:**\n- Mapas vectoriales de Buenos Aires y AMBA.\n\n**Se busca obtener:**\n- Mapas vectoriales de Buenos Aires y AMBA de menor tamaño.\n- Una opción de mapa de Buenos Aires sin las comunas de CABA.\n- Centroides de los departamentos de provincia de Buenos Aires.\n\n---\n\n```{r setup, echo = FALSE}\n\nknitr::opts_chunk$set(warning = FALSE)\nlibrary(tidyverse)\nlibrary(stringr)\nlibrary(sf)\n\n```\n\n\n\nEl AMBA consta de 40 municipios mas ciudad de buenos aires. Vamos a hacer una seleccion de amba con menos partidos.\nfuente: https://www.argentina.gob.ar/dami/centro/amba\n\n\n```{r}\n\n# Lista de los partidos que vamos a considerar AMBA incluyendo comunas CABA\namba_reducido_names <- c('Almirante Brown',\n                         'Avellaneda',\n                         'Berazategui',\n                         paste('Comuna', 1:15), # CABA\n                         'Esteban Echeverría', 'Escobar', 'Ezeiza',\n                         'Florencio Varela',\n                         'General San Martín',\n                         'Hurlingham',\n                         'Ituzaingó',\n                         'José C. Paz',\n                         'La Matanza',  'Lanús', 'Lomas de Zamora',\n                         'Malvinas Argentinas', 'Merlo', 'Moreno', 'Morón',\n                         'Quilmes', 'Pilar', 'Presidente Perón',\n                         'San Fernando', 'San Isidro', 'San Miguel',\n                         'Tigre', 'Tres de Febrero',\n                         'Vicente López')\n\n# Estos shapefiles fueron extraidos del Instituto Geografico Nacional (IGN)\n\namba <- st_read(\"data/inicial/departamentos.shp\") |>\n  st_zm() |>\n  filter(str_detect(NAM, paste(amba_reducido_names, collapse = \"|\")),\n         SAG %in% c('ARBA - Gerencia de Servicios Catastrales',\n                    'Direc. de Catastro'))\n\n\n# Chequeo el resultado visualmente\namba_reducido <- amba |>\n  dplyr::select('partido' = NAM , geometry) |>\n  dplyr::filter(partido %in% amba_reducido_names)\n\nggplot() +\n  geom_sf(data = amba_reducido)+\n  theme_minimal()\n\n\n\n```\n\n\n### Elimino polígono fuera del área de análisis\n\nEl partido de San Fernando esta compuesto por dos polígonos, pero solo\nusaremos el que no es parte del Delta.\n\n```{r}\n\n# Visualizo el partido\nggplot() +\n  geom_sf(data = subset(amba_reducido,\n                        partido == 'San Fernando'))+\n  theme_minimal()\n\n# Fuerzo el pasaje a POLYGON, esto lo va a partir en dos filas\namba_reducido = st_cast(amba_reducido,\"POLYGON\")\n\n# Chequeo que se cual quiero eliminar\nggplot() +\n  geom_sf(data = amba_reducido$geom[30])+\n  theme_minimal()\n\n# Elimino el poligono extra\namba_reducido <- amba_reducido[-30,]\n\n# Archivo vectorial final de AMBA\nggplot() +\n  geom_sf(data = amba_reducido)+\n  theme_minimal()\n```\n\n\nEste es el archivo con los poligonos finales seleccionados para AMBA\n\n```{r}\n\n## guardo el archivo\n\nst_write(amba, \"data/procesada/amba_ampliado.gpkg\", append = FALSE)\n\n```\n\n## Provincia de Buenos Aires\n\n```{r}\n# Obtengo los poligonos desde el IGN\nbsas <- sf::st_read('data/inicial/departamentos.shp') |>\n  dplyr::filter(SAG %in% c('Direc. de Catastro', # comunas\n                           'ARBA - Gerencia de Servicios Catastrales'), # partidos de baires\n                GNA %in% c('Partido', 'Comuna')) |> # elimino prov de san juan\n  dplyr::select('partido' = NAM, geometry) |>\n  sf::st_zm()\n\n# Lo paso a poligono para eliminar el extra en San Fernando\nbsas = st_cast(bsas,\"POLYGON\")\n\n# Chequeo el numero de poligono que quiero eliminar\nggplot() +\n  geom_sf(data = bsas$geometry[126])+\n  theme_minimal()\n\n# Elimino el poligono extra\nbsas <- bsas[-126,]\n\n# Mapa final\nggplot() +\n  geom_sf(data = bsas)+\n  theme_minimal()\n\nwrite_sf(bsas, 'data/procesada/bsas.gpkg')\n```\n\n### Unifico las comunas de Capital Federal\n\nNo en todos los casos usaremos las comunas, asique creo archivos que no las \nposean.\n\n```{r}\n\n  # uno las comunas\n  caba <-  bsas[grep(\"Comuna\", bsas$partido), ] |>\n           st_union()\n\n  # aca podria agregar algun tipo de control de calidad para asegurarme que\n  # tengo la cantidad de comunas que son\n  # chequear que tenga proyeccion\n\n\n  # las reemplazo en el dataset por caba\n bsas_caba <-  bsas |>\n    slice(-grep(\"Comuna\", bsas$partido)) |>\n    rbind(st_sf(\n                geometry = caba,\n                partido = 'Capital Federal'\n    ))\n\n\n\n ggplot() +\n        geom_sf(data = subset(bsas_caba,\n                              partido == 'Capital Federal')) + \n        theme_minimal()\n\nwrite_sf(bsas_caba, 'data/procesada/bsas_caba.gpkg')\n```\n\n### Simplifico los poligonos para agilizar la app\n\nEs posible emplear la funcion `sf::st_simplify` con este mismo fin, \npero no conserva tan bien la topografia entre los poligonos, \nes por ello que uso este paquete donde se aplica el algoritmo de Visvalingam.\n\n```{r}\nbsas_caba <- st_read('data/procesada/bsas_caba.gpkg')\n\n\nlibrary(rmapshaper)\nbsas_caba_simple <- rmapshaper::ms_simplify(bsas_caba)\n\nst_write(bsas_caba_simple, \"data/procesada/bsas_caba_simple.gpkg\", append=FALSE)\n\n\n```\n\n\n### Calculo de centroides\n\nUso la función `sf::st_point_on_surface()` que evita que el centroide caiga\nfuera del polígono si este tiene forma irregular.\n\n```{r}\n\ncent <- bsas_caba_simple |> \n  st_point_on_surface()\n\n# guardo el archivo con los vectores de partidos de provincia de Buenos Aires\n\nggplot() +\n  geom_sf(data = bsas_caba)+\n  geom_sf(data = cent) +\n  theme_minimal()\n\n# guardo los centroides\nst_write(cent, \"data/procesada/centroides_mapa.gpkg\", append=FALSE)\n\n\n```\n\n\n\n\n\n","srcMarkdownNoYaml":"\n\n---\n\n**Datos iniciales:**\n- Mapas vectoriales de Buenos Aires y AMBA.\n\n**Se busca obtener:**\n- Mapas vectoriales de Buenos Aires y AMBA de menor tamaño.\n- Una opción de mapa de Buenos Aires sin las comunas de CABA.\n- Centroides de los departamentos de provincia de Buenos Aires.\n\n---\n\n```{r setup, echo = FALSE}\n\nknitr::opts_chunk$set(warning = FALSE)\nlibrary(tidyverse)\nlibrary(stringr)\nlibrary(sf)\n\n```\n\n\n## Area Metropolitana de Buenos Aires (AMBA) y Ciudad Autonoma de Buenos Aires (CABA)\n\nEl AMBA consta de 40 municipios mas ciudad de buenos aires. Vamos a hacer una seleccion de amba con menos partidos.\nfuente: https://www.argentina.gob.ar/dami/centro/amba\n\n\n```{r}\n\n# Lista de los partidos que vamos a considerar AMBA incluyendo comunas CABA\namba_reducido_names <- c('Almirante Brown',\n                         'Avellaneda',\n                         'Berazategui',\n                         paste('Comuna', 1:15), # CABA\n                         'Esteban Echeverría', 'Escobar', 'Ezeiza',\n                         'Florencio Varela',\n                         'General San Martín',\n                         'Hurlingham',\n                         'Ituzaingó',\n                         'José C. Paz',\n                         'La Matanza',  'Lanús', 'Lomas de Zamora',\n                         'Malvinas Argentinas', 'Merlo', 'Moreno', 'Morón',\n                         'Quilmes', 'Pilar', 'Presidente Perón',\n                         'San Fernando', 'San Isidro', 'San Miguel',\n                         'Tigre', 'Tres de Febrero',\n                         'Vicente López')\n\n# Estos shapefiles fueron extraidos del Instituto Geografico Nacional (IGN)\n\namba <- st_read(\"data/inicial/departamentos.shp\") |>\n  st_zm() |>\n  filter(str_detect(NAM, paste(amba_reducido_names, collapse = \"|\")),\n         SAG %in% c('ARBA - Gerencia de Servicios Catastrales',\n                    'Direc. de Catastro'))\n\n\n# Chequeo el resultado visualmente\namba_reducido <- amba |>\n  dplyr::select('partido' = NAM , geometry) |>\n  dplyr::filter(partido %in% amba_reducido_names)\n\nggplot() +\n  geom_sf(data = amba_reducido)+\n  theme_minimal()\n\n\n\n```\n\n\n### Elimino polígono fuera del área de análisis\n\nEl partido de San Fernando esta compuesto por dos polígonos, pero solo\nusaremos el que no es parte del Delta.\n\n```{r}\n\n# Visualizo el partido\nggplot() +\n  geom_sf(data = subset(amba_reducido,\n                        partido == 'San Fernando'))+\n  theme_minimal()\n\n# Fuerzo el pasaje a POLYGON, esto lo va a partir en dos filas\namba_reducido = st_cast(amba_reducido,\"POLYGON\")\n\n# Chequeo que se cual quiero eliminar\nggplot() +\n  geom_sf(data = amba_reducido$geom[30])+\n  theme_minimal()\n\n# Elimino el poligono extra\namba_reducido <- amba_reducido[-30,]\n\n# Archivo vectorial final de AMBA\nggplot() +\n  geom_sf(data = amba_reducido)+\n  theme_minimal()\n```\n\n\nEste es el archivo con los poligonos finales seleccionados para AMBA\n\n```{r}\n\n## guardo el archivo\n\nst_write(amba, \"data/procesada/amba_ampliado.gpkg\", append = FALSE)\n\n```\n\n## Provincia de Buenos Aires\n\n```{r}\n# Obtengo los poligonos desde el IGN\nbsas <- sf::st_read('data/inicial/departamentos.shp') |>\n  dplyr::filter(SAG %in% c('Direc. de Catastro', # comunas\n                           'ARBA - Gerencia de Servicios Catastrales'), # partidos de baires\n                GNA %in% c('Partido', 'Comuna')) |> # elimino prov de san juan\n  dplyr::select('partido' = NAM, geometry) |>\n  sf::st_zm()\n\n# Lo paso a poligono para eliminar el extra en San Fernando\nbsas = st_cast(bsas,\"POLYGON\")\n\n# Chequeo el numero de poligono que quiero eliminar\nggplot() +\n  geom_sf(data = bsas$geometry[126])+\n  theme_minimal()\n\n# Elimino el poligono extra\nbsas <- bsas[-126,]\n\n# Mapa final\nggplot() +\n  geom_sf(data = bsas)+\n  theme_minimal()\n\nwrite_sf(bsas, 'data/procesada/bsas.gpkg')\n```\n\n### Unifico las comunas de Capital Federal\n\nNo en todos los casos usaremos las comunas, asique creo archivos que no las \nposean.\n\n```{r}\n\n  # uno las comunas\n  caba <-  bsas[grep(\"Comuna\", bsas$partido), ] |>\n           st_union()\n\n  # aca podria agregar algun tipo de control de calidad para asegurarme que\n  # tengo la cantidad de comunas que son\n  # chequear que tenga proyeccion\n\n\n  # las reemplazo en el dataset por caba\n bsas_caba <-  bsas |>\n    slice(-grep(\"Comuna\", bsas$partido)) |>\n    rbind(st_sf(\n                geometry = caba,\n                partido = 'Capital Federal'\n    ))\n\n\n\n ggplot() +\n        geom_sf(data = subset(bsas_caba,\n                              partido == 'Capital Federal')) + \n        theme_minimal()\n\nwrite_sf(bsas_caba, 'data/procesada/bsas_caba.gpkg')\n```\n\n### Simplifico los poligonos para agilizar la app\n\nEs posible emplear la funcion `sf::st_simplify` con este mismo fin, \npero no conserva tan bien la topografia entre los poligonos, \nes por ello que uso este paquete donde se aplica el algoritmo de Visvalingam.\n\n```{r}\nbsas_caba <- st_read('data/procesada/bsas_caba.gpkg')\n\n\nlibrary(rmapshaper)\nbsas_caba_simple <- rmapshaper::ms_simplify(bsas_caba)\n\nst_write(bsas_caba_simple, \"data/procesada/bsas_caba_simple.gpkg\", append=FALSE)\n\n\n```\n\n\n### Calculo de centroides\n\nUso la función `sf::st_point_on_surface()` que evita que el centroide caiga\nfuera del polígono si este tiene forma irregular.\n\n```{r}\n\ncent <- bsas_caba_simple |> \n  st_point_on_surface()\n\n# guardo el archivo con los vectores de partidos de provincia de Buenos Aires\n\nggplot() +\n  geom_sf(data = bsas_caba)+\n  geom_sf(data = cent) +\n  theme_minimal()\n\n# guardo los centroides\nst_write(cent, \"data/procesada/centroides_mapa.gpkg\", append=FALSE)\n\n\n```\n\n\n\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"creacion_mapa_bsas.html"},"language":{"toc-title-document":"Tabla de contenidos","toc-title-website":"En esta página","related-formats-title":"Otros formatos","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Fuente","section-title-abstract":"Resumen","section-title-appendices":"Apéndices","section-title-footnotes":"Notas","section-title-references":"Referencias","section-title-reuse":"Reutilización","section-title-copyright":"Derechos de autor","section-title-citation":"Cómo citar","appendix-attribution-cite-as":"Por favor, cita este trabajo como:","appendix-attribution-bibtex":"BibTeX","title-block-author-single":"Autor/a","title-block-author-plural":"Autores/as","title-block-affiliation-single":"Afiliación","title-block-affiliation-plural":"Afiliaciones","title-block-published":"Fecha de publicación","title-block-modified":"Fecha de modificación","callout-tip-title":"Tip","callout-note-title":"Nota","callout-warning-title":"Advertencia","callout-important-title":"Importante","callout-caution-title":"Precaución","code-summary":"Código","code-tools-menu-caption":"Código","code-tools-show-all-code":"Mostrar todo el código","code-tools-hide-all-code":"Ocultar todo el código","code-tools-view-source":"Ver el código fuente","code-tools-source-code":"Ejecutar el código","code-line":"Línea","code-lines":"Líneas","copy-button-tooltip":"Copiar al portapapeles","copy-button-tooltip-success":"Copiado","repo-action-links-edit":"Editar esta página","repo-action-links-source":"Ver el código","repo-action-links-issue":"Informar de un problema","back-to-top":"Volver arriba","search-no-results-text":"Sin resultados","search-matching-documents-text":"documentos encontrados","search-copy-link-title":"Copiar el enlace en la búsqueda","search-hide-matches-text":"Ocultar resultados adicionales","search-more-match-text":"resultado adicional en este documento","search-more-matches-text":"resultados adicionales en este documento","search-clear-button-title":"Borrar","search-detached-cancel-button-title":"Cancelar","search-submit-button-title":"Enviar","search-label":"Buscar","toggle-section":"Alternar sección","toggle-sidebar":"Alternar barra lateral","toggle-dark-mode":"Alternar modo oscuro","toggle-reader-mode":"Alternar modo lector","toggle-navigation":"Navegación de palanca","crossref-fig-title":"Figura","crossref-tbl-title":"Tabla","crossref-lst-title":"Listado","crossref-thm-title":"Teorema","crossref-lem-title":"Lema","crossref-cor-title":"Corolario","crossref-prp-title":"Proposición","crossref-cnj-title":"Conjetura","crossref-def-title":"Definición","crossref-exm-title":"Ejemplo","crossref-exr-title":"Ejercicio","crossref-ch-prefix":"Capítulo","crossref-apx-prefix":"Apéndice","crossref-sec-prefix":"Sección","crossref-eq-prefix":"Ecuación","crossref-lof-title":"Listado de Figuras","crossref-lot-title":"Listado de Tablas","crossref-lol-title":"Listado de Listados","environment-proof-title":"Prueba","environment-remark-title":"Observación","environment-solution-title":"Solución","listing-page-order-by":"Ordenar por","listing-page-order-by-default":"Por defecto","listing-page-order-by-date-asc":"Menos reciente","listing-page-order-by-date-desc":"Más reciente","listing-page-order-by-number-desc":"De mayor a menor","listing-page-order-by-number-asc":"De menor a mayor","listing-page-field-date":"Fecha","listing-page-field-title":"Título","listing-page-field-description":"Descripción","listing-page-field-author":"Autor/a","listing-page-field-filename":"Nombre de archivo","listing-page-field-filemodified":"Fecha de modificación","listing-page-field-subtitle":"Subtítulo","listing-page-field-readingtime":"Tiempo de lectura","listing-page-field-categories":"Categorías","listing-page-minutes-compact":"{0} minutos","listing-page-category-all":"Todas","listing-page-no-matches":"No hay resultados"},"metadata":{"lang":"es","fig-responsive":true,"quarto-version":"1.3.433","theme":"cosmo","title":"Creación Mapas Buenos Aires"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}